!function(){"use strict";const t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;function e(e,n,s=null){return new Promise(((o,a)=>{const i=t.open(e,n);i.onerror=function(t){a(t)},i.onupgradeneeded=function(t){const e=t.target.result;s?.(e)},i.onsuccess=function(t){o(i.result)}}))}const n=function(t,e=[],n="id",s=!0,o){const a=o.createObjectStore(t,{keyPath:n,autoIncrement:s});e.forEach((t=>{a.createIndex(t[0],t[1],t[2])}))}.bind(void 0,"tasks",[["taskText",["taskText"],{unique:!1}],["completed",["completed"],{unique:!1}],["deleted",["deleted"],{unique:!1}]],"id",!0);async function s(t,s,o){const a=await e("todo",1,n),i=await function(t,e,n,s,o){return new Promise(((a,i)=>{const r={queryType:"update",result:null,error:null,ok:!1},c=o.transaction(s,"readwrite"),l=c.objectStore(s),d=l.get(t);d.onerror=function(t){r.error=t,i(r)},d.onsuccess=function(t){d.result[e]=n,l.put(d.result),r.result=d.result,r.ok=!0,a(r)},c.oncomplete=function(t){o.close()}}))}(t,s,o,"tasks",a);return i}const o=document.getElementById("info-dialog"),a=document.getElementById("info-dialog-open"),i=document.getElementById("info-dialog-close");a.addEventListener("click",(t=>{o.showModal(),o.classList.add("--opening")})),i.addEventListener("click",(t=>{o.classList.add("--closing")})),document.documentElement.addEventListener("mouseup",(t=>{if(!o.hasAttribute("open"))return;const e=o.getClientRects(),n=e[0].left+e[0].width,s=e[0].top+e[0].height;(t.clientX<e[0].left||t.clientX>n||t.clientY<e[0].top||t.clientY>s)&&o.classList.add("--closing")})),o.addEventListener("animationend",(t=>{o.classList.contains("--opening")?o.classList.remove("--opening"):o.classList.contains("--closing")&&(o.close(),o.classList.remove("--closing"))}));const r=new Map,c=document.getElementById("task-form"),l=document.getElementById("task-input"),d=document.getElementById("tasks-list"),u=document.getElementById("completed-tasks-list"),m=document.getElementById("deleted-tasks-list");function p(t,e=null,n=d){const s=document.createElement("li"),o=document.createElement("div"),a=document.createElement("textarea"),i=document.createElement("button"),c=document.createElement("button"),l=document.createElement("button"),u=document.createElement("button");return s.classList.add("tasks-list__item"),o.classList.add("tasks-list__item-wrapper"),a.classList.add("tasks-list__item-text","interactive-element"),a.setAttribute("disabled",""),a.innerText=t,a.style.resize="none",i.classList.add("tasks-list__item-button","tasks-list__edit-button","interactive-element"),c.classList.add("tasks-list__item-button","tasks-list__complete-button","interactive-element"),l.classList.add("tasks-list__item-button","tasks-list__recover-button","interactive-element"),u.classList.add("tasks-list__item-button","tasks-list__delete-button","interactive-element"),i.type="button",c.type="button",l.type="button",u.type="button",i.setAttribute("data-type","edit"),c.setAttribute("data-type","complete"),l.setAttribute("data-type","recover"),u.setAttribute("data-type","delete"),i.innerHTML='<img src="img/icons/edit.svg" alt="Редактировать" class="tasks-list__item-button-img">',c.innerHTML='<img src="img/icons/complete.svg" alt="Выполнить" class="tasks-list__item-button-img">',l.innerHTML='<img src="img/icons/recover.svg" alt="Вернуть в список задач" class="tasks-list__item-button-img">',u.innerHTML='<img src="img/icons/cross.svg" alt="Удалить" class="tasks-list__item-button-img">',l.style.display="none",s.append(o),o.append(a,i,l,c,u),n.append(s),s.classList.add("--expanded"),g(a),r.set(s,{id:e,taskWrapper:o,taskText:a,taskEditButton:i,taskRecoverButton:l,taskCompleteButton:c,taskDeleteButton:u}),s.addEventListener("click",b),a.addEventListener("keydown",(t=>{t.shiftKey||"Enter"!==t.key?t.shiftKey&&"Enter"===t.key&&g(t.currentTarget):f(r.get(s))})),a.addEventListener("input",(t=>g(t.currentTarget))),s}async function k(t,o,a=!1){"deleted-tasks-list"===t.closest("ul").id&&(a=!0),a?(await async function(t){const s=await e("todo",1,n);return await function(t,e,n){return new Promise(((s,o)=>{const a={queryType:"delete",result:null,error:null,ok:!1},i=n.transaction(e,"readwrite"),r=i.objectStore(e).delete(t);i.onerror=function(t){a.error=t,o(a)},r.onsuccess=function(e){a.result=t,a.ok=!0,s(a)},i.oncomplete=function(t){n.close()}}))}(t,"tasks",s)}(o.id),t.classList.add("--wrapped"),t.addEventListener("animationend",(e=>{t.remove()}),{once:!0})):(await s(o.id,"deleted",!0),t.classList.add("--wrapped"),t.addEventListener("animationend",(e=>{m.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),o.taskEditButton.style.display="none",o.taskCompleteButton.style.display="none",o.taskRecoverButton.style.display="flex"}),{once:!0}))}async function y(t,e,n,o){n===d&&await s(e.id,"completed",!1),await s(e.id,"deleted",!1),n.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),e.taskEditButton.style.display=o.editButton,e.taskCompleteButton.style.display=o.completeButton,e.taskRecoverButton.style.display=o.recoverButton,e.taskDeleteButton.style.display=o.deleteButton}async function f(t){const e=t.taskEditButton.querySelector("img");"Редактировать"===e.alt?(e.src="img/icons/save.svg",e.alt="Сохранить",t.taskText.removeAttribute("disabled"),t.taskText.style.resize="vertical",t.taskText.focus(),t.taskText.selectionStart=t.taskText.value.length,t.taskDeleteButton.setAttribute("disabled",""),t.taskCompleteButton.setAttribute("disabled",""),t.taskRecoverButton.setAttribute("disabled","")):"Сохранить"===e.alt&&(e.src="img/icons/edit.svg",e.alt="Редактировать",t.taskText.setAttribute("disabled",""),t.taskText.style.resize="none",setTimeout((()=>t.taskEditButton.focus()),1),t.taskDeleteButton.removeAttribute("disabled"),t.taskCompleteButton.removeAttribute("disabled"),t.taskRecoverButton.removeAttribute("disabled"),async function(t){await s(t.id,"taskText",t.taskText.value)}(t))}function g(t){t.style.height="40px",t.scrollHeight>t.offsetHeight&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}function b(t){const o=t.target.closest("li.tasks-list__item"),a=t.target.closest("button");if(!o||!a)return;const i=r.get(o);switch(a.getAttribute("data-type")){case"edit":f(i);break;case"complete":!async function(t,e){await s(e.id,"completed",!0),t.classList.add("--wrapped"),t.addEventListener("animationend",(n=>{u.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),e.taskEditButton.style.display="none",e.taskCompleteButton.style.display="none",e.taskRecoverButton.style.display="flex"}),{once:!0})}(o,i);break;case"recover":!async function(t,s){const o=await async function(t){const s=await e("todo",1,n),o=await function(t,e,n){return new Promise(((s,o)=>{const a={queryType:"get",result:null,error:null,ok:!1},i=n.transaction(e,"readonly"),r=i.objectStore(e).get(t);r.onerror=function(t){a.error=t,o(a)},r.onsuccess=function(t){a.result=r.result,a.ok=!0,s(a)},i.oncomplete=function(t){n.close()}}))}(t,"tasks",s);return o}(s.id);t.classList.add("--wrapped"),t.addEventListener("animationend",(function(e){o?.result?.deleted&&o?.result?.completed?y(t,s,u,{editButton:"none",completeButton:"none",recoverButton:"flex",deleteButton:"flex"}):y(t,s,d,{editButton:"flex",completeButton:"flex",recoverButton:"none",deleteButton:"flex"})}),{once:!0})}(o,i);break;case"delete":k(o,i)}}document.querySelector(".user__clear-all-tasks").addEventListener("click",(async function(t){await async function(){const t=await e("todo",1,n),s=await function(t,e){return new Promise(((n,s)=>{const o={queryType:"clear",result:null,error:null,ok:!1},a=e.transaction(t,"readwrite"),i=a.objectStore(t).clear();i.onerror=function(t){o.error=t,s(o)},i.onsuccess=function(e){o.result={clearedStore:t},o.ok=!0,n(o)},a.oncomplete=function(t){e.close()}}))}("tasks",t);return s}();for(const[t,e]of r.entries())k(t,e,!0),r.delete(t)})),c.addEventListener("submit",(async function(t){t.preventDefault(),await async function(t){const s=await async function(t){const s=await e("todo",1,n),o=await function(t=[],e,n){return new Promise(((s,o)=>{const a={queryType:"put",result:[],error:null,ok:!1},i=n.transaction(e,"readwrite"),r=i.objectStore(e);t.forEach((t=>{const e=r.put(t);e.onsuccess=function(n){t.key=e.result,a.result.push(t)}})),i.onerror=function(t){a.result=null,a.error=t,o(a)},i.oncomplete=function(t){a.ok=!0,n.close(),s(a)}}))}(t,"tasks",s);return o}([{taskText:t,completed:!1,deleted:!1}]);return p(t,s.result[0].key)}(l.value),c.reset()})),document.addEventListener("DOMContentLoaded",(async function(t){(await async function(){const t=await e("todo",1,n),s=await function(t,e){return new Promise(((n,s)=>{const o={queryType:"get",result:null,error:null,ok:!1},a=e.transaction(t,"readonly"),i=a.objectStore(t).getAll();i.onerror=function(t){o.error=t,s(o)},i.onsuccess=function(t){o.result=i.result,o.ok=!0,n(o)},a.oncomplete=function(t){e.close()}}))}("tasks",t);return s}()).result.forEach((t=>{t.deleted?p(t.taskText,t.id,m):t.completed?p(t.taskText,t.id,u):p(t.taskText,t.id)}))}))}();