!function(){"use strict";const t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;function e(e,n,s=null){return new Promise(((o,i)=>{const a=t.open(e,n);a.onerror=function(t){i(t)},a.onupgradeneeded=function(t){const e=t.target.result;s?.(e)},a.onsuccess=function(t){o(a.result)}}))}const n=function(t,e=[],n="id",s=!0,o){const i=o.createObjectStore(t,{keyPath:n,autoIncrement:s});e.forEach((t=>{i.createIndex(t[0],t[1],t[2])}))}.bind(void 0,"tasks",[["taskText",["taskText"],{unique:!1}],["completed",["completed"],{unique:!1}],["deleted",["deleted"],{unique:!1}]],"id",!0);async function s(t,s,o){const i=await e("todo",1,n),a=await function(t,e,n,s,o){return new Promise(((i,a)=>{const l={queryType:"update",result:null,error:null,ok:!1},d=o.transaction(s,"readwrite"),c=d.objectStore(s),r=c.get(t);r.onerror=function(t){l.error=t,a(l)},r.onsuccess=function(t){r.result[e]=n,c.put(r.result),l.result=r.result,l.ok=!0,i(l)},d.oncomplete=function(t){o.close()}}))}(t,s,o,"tasks",i);return a}function o(t,e){t.showModal(),document.body.classList.add("--modal-opened"),t.classList.add("--opening")}function i(t,e){t.classList.add("--closing")}document.querySelectorAll("[data-dialog]").forEach((t=>{const e=document.getElementById(t.getAttribute("data-dialog"));t.addEventListener("click",o.bind(void 0,e)),e.querySelector("[data-dialog-close]").addEventListener("click",i.bind(void 0,e)),e.addEventListener("animationend",(t=>{e.classList.contains("--opening")?e.classList.remove("--opening"):e.classList.contains("--closing")&&(e.close(),e.classList.remove("--closing"),document.body.classList.remove("--modal-opened"))}))}));const a={isDown:!1,isDownOnDialog:!1,openedDialog:null};function l(t,e){if(!t)return!1;const n=t.getClientRects(),s=n[0].left+n[0].width,o=n[0].top+n[0].height;return!(e.clientX<n[0].left||e.clientX>s||e.clientY<n[0].top||e.clientY>o)}document.documentElement.addEventListener("pointerdown",(t=>{a.isDown=!0,a.openedDialog=document.querySelector("dialog[open]"),l(a.openedDialog,t)?a.isDownOnDialog=!0:a.isDownOnDialog=!1})),document.documentElement.addEventListener("pointerup",(t=>{a.openedDialog&&(a.isDownOnDialog||l(a.openedDialog,t)||(a.openedDialog.classList.add("--closing"),a.isDown=!1,a.isDownOnDialog=!1,a.openedDialog=null))}));const d=new Map,c=document.getElementById("task-form"),r=document.getElementById("task-input"),u=document.getElementById("tasks-list"),m=document.getElementById("completed-tasks-list"),p=document.getElementById("deleted-tasks-list");function k(t,e=null,n=u){const s=document.createElement("li"),o=document.createElement("div"),i=document.createElement("textarea"),a=document.createElement("button"),l=document.createElement("button"),c=document.createElement("button"),r=document.createElement("button");return s.classList.add("tasks-list__item"),o.classList.add("tasks-list__item-wrapper"),i.classList.add("tasks-list__item-text","interactive-element"),i.setAttribute("disabled",""),i.innerText=t,i.style.resize="none",a.classList.add("tasks-list__item-button","tasks-list__edit-button","interactive-element"),l.classList.add("tasks-list__item-button","tasks-list__complete-button","interactive-element"),c.classList.add("tasks-list__item-button","tasks-list__recover-button","interactive-element"),r.classList.add("tasks-list__item-button","tasks-list__delete-button","interactive-element"),a.type="button",l.type="button",c.type="button",r.type="button",a.setAttribute("data-type","edit"),l.setAttribute("data-type","complete"),c.setAttribute("data-type","recover"),r.setAttribute("data-type","delete"),a.innerHTML='<img src="img/icons/edit.svg" alt="Редактировать" class="tasks-list__item-button-img">',l.innerHTML='<img src="img/icons/complete.svg" alt="Выполнить" class="tasks-list__item-button-img">',c.innerHTML='<img src="img/icons/recover.svg" alt="Вернуть в список задач" class="tasks-list__item-button-img">',r.innerHTML='<img src="img/icons/cross.svg" alt="Удалить" class="tasks-list__item-button-img">',c.style.display="none",s.append(o),o.append(i,a,c,l,r),n.append(s),s.classList.add("--expanded"),f(i),d.set(s,{id:e,taskWrapper:o,taskText:i,taskEditButton:a,taskRecoverButton:c,taskCompleteButton:l,taskDeleteButton:r}),s.addEventListener("click",w),i.addEventListener("keydown",(t=>{t.shiftKey||"Enter"!==t.key?t.shiftKey&&"Enter"===t.key&&f(t.currentTarget):g(d.get(s))})),i.addEventListener("input",(t=>f(t.currentTarget))),s}async function y(t,e,n,o){n===u&&await s(e.id,"completed",!1),await s(e.id,"deleted",!1),n.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),e.taskEditButton.style.display=o.editButton,e.taskCompleteButton.style.display=o.completeButton,e.taskRecoverButton.style.display=o.recoverButton,e.taskDeleteButton.style.display=o.deleteButton}async function g(t){const e=t.taskEditButton.querySelector("img");"Редактировать"===e.alt?(e.src="img/icons/save.svg",e.alt="Сохранить",t.taskText.removeAttribute("disabled"),t.taskText.style.resize="vertical",t.taskText.focus(),t.taskText.selectionStart=t.taskText.value.length,t.taskDeleteButton.setAttribute("disabled",""),t.taskCompleteButton.setAttribute("disabled",""),t.taskRecoverButton.setAttribute("disabled","")):"Сохранить"===e.alt&&(e.src="img/icons/edit.svg",e.alt="Редактировать",t.taskText.setAttribute("disabled",""),t.taskText.style.resize="none",setTimeout((()=>t.taskEditButton.focus()),1),t.taskDeleteButton.removeAttribute("disabled"),t.taskCompleteButton.removeAttribute("disabled"),t.taskRecoverButton.removeAttribute("disabled"),async function(t){await s(t.id,"taskText",t.taskText.value)}(t))}function f(t){t.style.height="40px",t.scrollHeight>t.offsetHeight&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}function w(t){const o=t.target.closest("li.tasks-list__item"),i=t.target.closest("button");if(!o||!i)return;const a=d.get(o);switch(i.getAttribute("data-type")){case"edit":g(a);break;case"complete":!async function(t,e){await s(e.id,"completed",!0),t.classList.add("--wrapped"),t.addEventListener("animationend",(n=>{m.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),e.taskEditButton.style.display="none",e.taskCompleteButton.style.display="none",e.taskRecoverButton.style.display="flex"}),{once:!0})}(o,a);break;case"recover":!async function(t,s){const o=await async function(t){const s=await e("todo",1,n),o=await function(t,e,n){return new Promise(((s,o)=>{const i={queryType:"get",result:null,error:null,ok:!1},a=n.transaction(e,"readonly"),l=a.objectStore(e).get(t);l.onerror=function(t){i.error=t,o(i)},l.onsuccess=function(t){i.result=l.result,i.ok=!0,s(i)},a.oncomplete=function(t){n.close()}}))}(t,"tasks",s);return o}(s.id);t.classList.add("--wrapped"),t.addEventListener("animationend",(function(e){o?.result?.deleted&&o?.result?.completed?y(t,s,m,{editButton:"none",completeButton:"none",recoverButton:"flex",deleteButton:"flex"}):y(t,s,u,{editButton:"flex",completeButton:"flex",recoverButton:"none",deleteButton:"flex"})}),{once:!0})}(o,a);break;case"delete":!async function(t,o,i=!1){"deleted-tasks-list"===t.closest("ul").id&&(i=!0),i?(await async function(t){const s=await e("todo",1,n),o=await function(t,e,n){return new Promise(((s,o)=>{const i={queryType:"delete",result:null,error:null,ok:!1},a=n.transaction(e,"readwrite"),l=a.objectStore(e).delete(t);a.onerror=function(t){i.error=t,o(i)},l.onsuccess=function(e){i.result=t,i.ok=!0,s(i)},a.oncomplete=function(t){n.close()}}))}(t,"tasks",s);return o}(o.id),t.classList.add("--wrapped"),t.addEventListener("animationend",(e=>{t.remove()}),{once:!0})):(await s(o.id,"deleted",!0),t.classList.add("--wrapped"),t.addEventListener("animationend",(e=>{p.append(t),t.classList.remove("--wrapped"),t.classList.add("--expanded"),o.taskEditButton.style.display="none",o.taskCompleteButton.style.display="none",o.taskRecoverButton.style.display="flex"}),{once:!0}))}(o,a)}}c.addEventListener("submit",(async function(t){t.preventDefault(),await async function(t){const s=await async function(t){const s=await e("todo",1,n),o=await function(t=[],e,n){return new Promise(((s,o)=>{const i={queryType:"put",result:[],error:null,ok:!1},a=n.transaction(e,"readwrite"),l=a.objectStore(e);t.forEach((t=>{const e=l.put(t);e.onsuccess=function(n){t.key=e.result,i.result.push(t)}})),a.onerror=function(t){i.result=null,i.error=t,o(i)},a.oncomplete=function(t){i.ok=!0,n.close(),s(i)}}))}(t,"tasks",s);return o}([{taskText:t,completed:!1,deleted:!1}]);return k(t,s.result[0].key)}(r.value),c.reset()})),document.addEventListener("DOMContentLoaded",(async function(t){(await async function(){const t=await e("todo",1,n),s=await function(t,e){return new Promise(((n,s)=>{const o={queryType:"get",result:null,error:null,ok:!1},i=e.transaction(t,"readonly"),a=i.objectStore(t).getAll();a.onerror=function(t){o.error=t,s(o)},a.onsuccess=function(t){o.result=a.result,o.ok=!0,n(o)},i.oncomplete=function(t){e.close()}}))}("tasks",t);return s}()).result.forEach((t=>{t.deleted?k(t.taskText,t.id,p):t.completed?k(t.taskText,t.id,m):k(t.taskText,t.id)}))}))}();